# 🧠 Otziv WhatsApp Message Sender

Spring Boot-приложение для автоматизированной рассылки сообщений в WhatsApp с кросс-клиентной уникализацией и логированием, обёрнутое в Docker.

---

## 📌 Основные фичи

- 📤 Рассылка сообщений по лидам из базы данных
- 🔄 Повторная отправка при ошибке, лимиты в день
- 💬 Генерация уникального текста:
  - синонимы + рандомные эмодзи
  - псевдо-опечатки
  - маркеры завершения
- 🧠 Антиспам: контроль повторов через `SHA-1` хэши
- 🗂 Хэши сообщений сохраняются в `sent-hashes.txt`
- 🧹 Старые хэши очищаются (старше 30 дней)
- 📊 Автоотчёт по завершению

---

## 📦 Структура проекта

```
.
├── docker-compose.yml
├── Dockerfile
├── src/
├── docker/
│   └── sent-hashes/         # 🧠 Общий файл хэшей
│
├── data/
│   └── app-logs/            # 🪵 Логи приложения
│   └── mysql_backup/        # 📦 Бэкапы БД
│   └── bots/                # ⚙️ Данные MySQL
│   └── nginx/               # 🌐 Конфиги nginx
```

---

## 🧪 Запуск

1. Собери приложение:

```bash
mvn clean package -DskipTests
```

2. Запусти контейнер:

```bash
docker-compose up -d --build
```

3. Проверь, что `sent-hashes.txt` создаётся:

```bash
cat ./docker/sent-hashes/sent-hashes.txt
```

---

## ⚙️ Ключевые настройки

### 📍 `PersistentSentHashes.java`

- Хэшируется каждое сообщение перед отправкой
- Проверяется в `sent-hashes.txt` — если уже есть, генерируется заново
- Строка формата:
  ```
  47de4c0ae7cf95ff7cf3b6c993e5a...:2025-05-25T14:22:03
  ```

### 📍 `MessageHumanizer.java`

- Использует:
  - `synonyms` — словарь замен
  - `emojis` — список эмодзи
  - `markers` — завершения
  - `typoMap` — карта псевдо-опечаток

### 📍 `docker-compose.yml`

- Папка `./docker/sent-hashes` монтируется в `/app/sent-hashes`
- Поддерживает просмотр логов через `log-viewer`

---

## 🔐 Переменные окружения

Смотри `.env`:

```env
MYSQL_ROOT_PASSWORD=...
TELEGRAM_BOT_TOKEN_LOCAL_DOCKER=...
MAIL_USERNAME=...
...
```

---

## 🧼 Автоочистка

При запуске и использовании:

- Все хэши старше 30 дней удаляются
- Файл `sent-hashes.txt` перезаписывается

---

## ✅ Результат

- ❌ Никакие сообщения не дублируются
- ⚠️ Если не удаётся сгенерировать новое уникальное сообщение — логируется предупреждение
- 📩 Каждый отправленный текст — оригинальный, в пределах заданных шаблонов
